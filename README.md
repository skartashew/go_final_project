# Планировщик задач

## Описание проекта
Этот проект — веб-сервер на Go, реализующий простой планировщик задач (TODO-лист). 
Он позволяет добавлять задачи с датой, заголовком, комментарием и правилом повторения, а также управлять ими через REST API. 
Фронтенд предоставлен в папке `web`. Задачи хранятся в SQLite базе данных `scheduler.db`. 
Поддерживается аутентификация через JWT-токен с использованием пароля из переменной окружения `TODO_PASSWORD`.

Проект выполнен в рамках итогового задания курса.

## Выполненные задания со звёздочкой
- Шаг 1: Поддержка переменной `TODO_PORT` для установки порта.
- Шаг 2: Поддержка `TODO_DBFILE` для пути к базе данных.
- Шаг 3: Реализация правил повторения (`d`, `y`, `w`, `m`) в функции `NextDate`.
- Шаг 5: Поиск задач по тексту и дате через параметр `search` в `/api/tasks`.
- Шаг 8: Аутентификация через `TODO_PASSWORD` с использованием JWT-токена.
- Шаг 8: Создание Docker-образа с инструкцией для запуска.

## Инструкция по запуску локально
1. Убедитесь, что у вас установлен Go (версия 1.24 или выше).
2. Склонируйте репозиторий:

   git clone https://github.com/skartashew/go_final_project.git
   cd go_final_project

3. Переключитесь на ветку `dev`:

   git checkout dev

4. Установите зависимости:

   go get github.com/golang-jwt/jwt/v5
   go get github.com/mattn/go-sqlite3

5. Скомпилируйте проект:

   go build

6. Запустите сервер:

   TODO_PASSWORD=secret ./go_final_project

- По умолчанию сервер работает на `http://localhost:7540`.
- Для другого порта используйте `TODO_PORT`, например: `TODO_PORT=8080 TODO_PASSWORD=secret ./go_final_project`.
- База данных `scheduler.db` создаётся в текущей директории, если не указан `TODO_DBFILE`.
- Для настройки JWT-токена можно указать `TODO_JWT_SECRET`, иначе используется значение по умолчанию (`my_secret_key`).
7. Откройте `http://localhost:7540` в браузере и войдите с паролем `secret`.

## Инструкция по запуску тестов
1. Убедитесь, что сервер скомпилирован и зависимости установлены.
2. Перейдите в директорию проекта:

   cd ~/go/project/go_final_project

3. Запустите тесты:

   go test ./tests

4. Для тестов с аутентификацией:
- Запустите сервер: `TODO_PASSWORD=secret ./go_final_project`.
- Получите токен:
  ```
  curl -X POST -d '{"password":"secret"}' -H "Content-Type: application/json" http://localhost:7540/api/signin
  ```
- В файле `tests/settings.go` установите `Token = "<полученный_токен>"`.
- Установите `FullNextDate = true` и `Search = true` для проверки всех правил повторения и поиска.
- Повторно запустите: `go test ./tests`.

## Инструкция по сборке и запуску через Docker
1. Убедитесь, что Docker установлен.
2. Соберите образ:

   docker build -t go-final-project .

3. Запустите контейнер:

   docker run -d -p 7540:7540 -v $(pwd):/data -e TODO_PASSWORD=secret go-final-project

- `-p 7540:7540` — пробрасывает порт.
- `-v $(pwd):/data` — монтирует текущую директорию хоста в `/data` контейнера для доступа к `scheduler.db`.
- `-e TODO_PASSWORD=secret` — задаёт пароль для аутентификации.
- Для другого порта добавьте `-e TODO_PORT=8080`.
- Для кастомного JWT-ключа добавьте `-e TODO_JWT_SECRET=your_secure_key`.
4. Откройте `http://localhost:7540` в браузере.
5. Остановите контейнер:

   docker ps  # найдите CONTAINER ID
   docker stop <CONTAINER_ID>

## Структура проекта
- `main.go` — точка входа, настройка сервера и базы данных.
- `handlers.go` — обработчики API-запросов и логика повторения задач.
- `auth.go` — аутентификация через JWT-токен.
- `Dockerfile` — инструкция для сборки Docker-образа.
- `web/` — фронтенд.
- `scheduler.db` — база данных SQLite (создаётся при первом запуске).

## Заметки
- Секретный ключ для JWT (`my_secret_key`) захардкожен в коде.
- Проект протестирован на Go 1.24 и Docker Desktop.

